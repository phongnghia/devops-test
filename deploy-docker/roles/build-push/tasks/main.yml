---
- name: Build Docker image
  shell: "docker build -t {{ ecr_repository_name }}:latest  {{ home_directory }}"

- name: Tag Docker image
  shell: "docker tag {{ ecr_repository_name }}:latest {{ ecr_repository_registry }}/{{ ecr_repository_name }}:latest"

- name: Login to docker
  shell: "docker login -u {{ dockerhub_username }} -p {{ dockerhub_token }}"
  register: login_docker
  failed_when: false
  changed_when: login_docker.rc != 0
  no_log: true

- name: Push Docker image
  shell: "docker push {{ ecr_repository_registry }}/{{ ecr_repository_name }}:latest"